<!DOCTYPE html>
<html>
<head>
    <title>Request</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>
</head>
<body>
    <nav class="navbar navbar-light" style="background-color: powderblue;">
        <a class="navbar-brand"  href="/">Home</a>
        <a class="nav-item nav-link" style="text-align: right" href="/logout">Logout</a>
    </nav>
    <div class="container mt-3">
        <div class="row">
            <div class="col-12" id="req">
                <div class="card">
                    <h5 class="card-header">Add Request</h5>
                    <div class="card-body">
                        <form method="post" action="/{{action}}/" id="form">
                            {% csrf_token %}
                            
                            <label for="">Items</label>
                            <input type="number" name="item_count" id="item_count" value="0" hidden>
                            <button type="button" class="btn btn-primary" onclick="add_item()">Add Item</button><br>
                            {{form.as_p}}
                            <input id="submitBtn" type="submit" value="Send" />
                        </form>
                    </div>
                </div>
            </div>
        </div>        
    </div>
    <script>

        item_count = 0;
        function add_item() {
            item_count++;
            var row = document.createElement("div");
            row.setAttribute("class", "form-row");
            var col_i = document.createElement("div");
            col_i.setAttribute("class", "form-group col-md-6");
            var col_a = document.createElement("div");
            col_a.setAttribute("class", "form-group col-md-6");
            var item = document.createElement("input");
            item.setAttribute("type", "text");
            item.setAttribute("name", "item" + item_count);
            item.setAttribute("id", "item" + item_count);
            item.setAttribute("placeholder", "Item " + item_count);
            item.setAttribute("class", "form-control");
            item.setAttribute("required", "true");
            var amount = document.createElement("input");
            amount.setAttribute("type", "number");
            amount.setAttribute("name", "amount" + item_count);
            amount.setAttribute("id", "amount" + item_count);
            amount.setAttribute("placeholder", "Amount " + item_count);
            amount.setAttribute("class", "form-control");
            amount.setAttribute("required", "true");
            col_i.appendChild(item);
            col_a.appendChild(amount);
            row.appendChild(col_i);
            row.appendChild(col_a);
            document.getElementById("item_count").before(row);
            //document.getElementById("item_count").before(item)
            //document.getElementById("item_count").before(amount)
            //document.getElementById("item_count").before(document.createElement("br"))
            document.getElementById("item_count").setAttribute("value", item_count);
            var map = document.createElement("div");
            map.setAttribute("id", "map");
            map.setAttribute("style", "width: 600px; height: 400px; margin-top: 10px;");
            document.getElementById("id_longitude").after(map);
            
        }
        add_item();
        document.querySelectorAll("input").forEach(e => e.setAttribute("class","form-control"))
        document.querySelectorAll("textarea").forEach(e => e.setAttribute("class","form-control"))
        document.querySelectorAll("select").forEach(e => e.setAttribute("class","form-control"))
        
    
    </script>
    <script>
        // Initialize the map
        var map = L.map('map').setView([39.89178919874682, 32.78354912996293], 13);
        var marker;
        // Create a tile layer for the map
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
          maxZoom: 18,
        }).addTo(map);
      
        // Initialize the location selector input
        function onMapClick(e) {
        var lat = e.latlng.lat;
        var lng = e.latlng.lng;
        document.getElementById("id_latitude").value = lat;
        document.getElementById("id_longitude").value = lng;
        if (marker) {
            map.removeLayer(marker);
        }

        // Create a new marker and add it to the map
        marker = L.marker([lat, lng]).addTo(map);
        // You can perform further actions with the obtained coordinates here
        }

        map.on('click', onMapClick);

      </script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
    
</body>
</html>